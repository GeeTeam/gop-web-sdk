"v1.0.0 Geetest Inc.";!function(a,b){"use strict";"object"==typeof exports&&"object"==typeof module?module.exports=b(a):"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.GOP=b(a):a.GOP=b(a)}("undefined"!=typeof window?window:this,function(a,b){function c(){this.a={}}function d(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];a[c]=d}}function e(){}function f(a){d(this,a),this.phone=0,this.process_id="",this.operator="CT",this.clientType="2",this.gtapi_domain="onepass.geetest.com",this.w=new c}function g(a){var b=this;b.D=i(),b.F=!0,j.u(b.D,new f(a))}var h=function(a){function b(){var a=this;a.g=a.h=null}function c(a){var e=this;if(e.m=e.PENDING,e.n=new b,e.o=new b,d(a))try{a(function(a){e.l(a)},function(a){e.j(a)})}catch(f){c.k(f)}}var d=function(a){return"function"==typeof a},f=function(a){return"object"==typeof a&&null!==a},g=function(a){a()};b.prototype={enqueue:function(a){var b=this,c={ele:a,next:null};null===b.g?b.g=this.h=c:(b.h.next=c,b.h=b.h.next)},dequeue:function(){var a=this;if(null===a.g)throw new e("queue is empty");var b=a.g.ele;return a.g=a.g.next,b},isEmpty:function(){return null===this.g},clear:function(){var a=this;a.g=a.i=null},each:function(a){var b=this;b.isEmpty()||(a(b.dequeue()),b.each(a))}};var h=function(a,b){if(a===b)a.j(new TypeError);else if(b instanceof c)b.then(function(b){h(a,b)},function(b){a.j(b)});else if(d(b)||f(b)){var e;try{e=b.then}catch(i){return c.k(i),void a.j(i)}var g=!1;if(d(e))try{e.call(b,function(b){g||(g=!0,h(a,b))},function(b){g||(g=!0,a.j(b))})}catch(i){if(g)return;g=!0,a.j(i)}else a.l(b)}else a.l(b)},i=!1;return c.debug=function(){i=!0},c.k=function(a){i&&"undefined"!=typeof console&&console.error(a)},c.prototype={PENDING:0,RESOLVED:1,REJECTED:-1,l:function(a){var b=this;b.m===b.PENDING&&(b.m=b.RESOLVED,b.p=a,b.q())},j:function(a){var b=this;b.m===b.PENDING&&(b.m=b.REJECTED,b.r=a,b.q())},q:function(){var a,b,c=this,d=c.m;d===c.RESOLVED?(a=c.n,c.o.clear(),b=c.p):d===c.REJECTED&&(a=c.o,c.n.clear(),b=c.r),a.each(function(a){g(function(){a(d,b)})})},s:function(a,b,e){var f=this;g(function(){if(d(b)){var g;try{g=b(e)}catch(i){return c.k(i),void f.j(i)}h(f,g)}else a===f.RESOLVED?f.l(e):a===f.REJECTED&&f.j(e)})},then:function(a,b){var d=this,e=new c;return d.n.enqueue(function(b,c){e.s(b,a,c)}),d.o.enqueue(function(a,c){e.s(a,b,c)}),d.m===d.RESOLVED?d.q():d.m===d.REJECTED&&d.q(),e}},c.all=function(a){return new c(function(b,d){function e(a,c,e){h||(null!==a&&(h=!0,d(a)),i[e]=c,(g+=1)===f&&(h=!0,b(i)))}for(var f=a.length,g=0,h=!1,i=[],j=0;j<f;j+=1)!function(b){var d=a[b];d instanceof c||(d=new c(d)),d.then(function(a){e(null,a,b)},function(a){e(a||!0)})}(j)})},c.race=function(a){return new c(function(b,d){function e(a,c){g||(null==a?(g=!0,b(c)):(h+=1)>=f&&(g=!0,d(a)))}for(var f=a.length,g=!1,h=0,i=0;i<f;i+=1)!function(b){var d=a[b];d instanceof c||(d=new c(d)),d.then(function(a){e(null,a)},function(a){e(a||!0)})}(i)})},c.step=function(a){var b=a.length,d=new c,e=function(f,g){if(f>=b)return d.l(g);new c(a[f]).then(function(a){e(f+1,a)},function(a){d.j(a)})};return new c(a[0]).then(function(a){e(1,a)},function(a){d.j(a)}),d},c.prototype.t=function(a,b){return this.then(a,b)},c}();h.debug(),c.prototype={b:function(a,b){var c=this;return c.a[a]?c.a[a].push(b):c.a[a]=[b],c},c:function(a,b){var c=this,d=c.a[a];if(d){for(var e=0,f=d.length;e<f;e+=1)d[e](b);return c}},d:function(){this.a={}}};var i=function(){return function(){return parseInt(1e4*Math.random())+(new Date).valueOf()}}(),j=function(){var a=[];return{u:function(b,c){a[b]=c},v:function(b){return a[b]}}}(),k=function(){return{e:function(){return a.XMLHttpRequest&&a.JSON},f:function(b,c,d,e){var f=a.JSON.stringify(c),g=new a.XMLHttpRequest;g.open("POST",b,!0),g.setRequestHeader("Content-Type","text/plain;charset=utf-8"),g.setRequestHeader("Accept","application/json"),g.onload=function(){d(a.JSON.parse(g.responseText))},g.onreadystatechange=function(){4===g.readyState&&(200===g.status?d(a.JSON.parse(g.responseText)):e({error:"status: "+g.status}))},g.send(f)}}}(),l=function(a,b){return new h(function(c,d){var e=document.getElementsByTagName("head")[0],f=document.createElement("script");f.onload=f.onreadystatechange=function(){f.readyState&&"loaded"!==f.readyState&&"complete"!==f.readyState?d("网络不给力"):c(f)},f.onerror=function(a){d("网络不给力"),f.parentNode.removeChild(f)},f.src=a,e.appendChild(f),setTimeout(function(){d("网络不给力"),f.parentNode.removeChild(f)},b||3e4)})},m=function(a){return a.replace(/^https?:\/\/|\/$/g,"")},n=function(a){return a=a.replace(/\/+/g,"/"),0!==a.indexOf("/")&&(a="/"+a),a},o=function(a){if(!a)return"";var b="?";for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b=b+encodeURIComponent(c)+"="+encodeURIComponent(d)+"&"}return"?"===b&&(b=""),b.replace(/&$/,"")},p=function(a,b,c,d){if(!0===d)return c;a=a||location.protocol+"//",b=m(b);var e=n(c);return b&&(e=a+b+e),e},q=function(b){var c=p(b.protocol,b.domain,b.path,b.fullurl),d=b.query;return new h(k.e()&&!b.get?function(a,e){k.f(c,d,function(b){a(b)},function(a){e(a)},b.timeout||3e4)}:function(e,f){var g=b.cb||"geetest_"+i();b.cb?g=b.cb:d.callback=g;var h=c+o(d);a[g]=function(c){b&&b.recordurl&&(c=c||{},c.url=h),e(c),a[g]=undefined;try{delete a[g]}catch(d){}},l(h,b.timeout||3e4).t(function(){},function(a){f(a)})})};return e.pre_gateway_net=function(a){return{code:100,err:a}},e.pre_gateway_result=function(a){return{code:101,err:a}},e.pre_getmobile_net=function(a){return{code:102,err:a}},e.pre_getmobile_result=function(a){return{code:103,err:a}},e.check_gateway_net=function(a){return{code:104,err:a}},e.check_gateway_result=function(a){return{code:105,err:a}},e.send_message_net=function(a){return{code:106,err:a}},e.send_message_result=function(a){return{code:107,err:a}},e.check_message_net=function(a){return{code:108,err:a}},e.check_message_result=function(a){return{code:109,err:a}},f.prototype={constructor:f,x:function(a){var b=this,c=b.w;this.phone=a.phone,this.process_id=a.process_id;var d="geetest_"+i();q({protocol:this.protocol,domain:this.gtapi_domain,path:"pre_gateway",query:{phone:this.phone,operator:this.operator,process_id:this.process_id,custom:this.custom,clientType:this.clientType,callback:d},timeout:this.timeout}).t(function(a){a&&0===a.result?(b.process_id=a.process_id,b.y(a,d)):c.c("gateway_fail",e.pre_gateway_result(a))},function(){c.c("gateway_fail",e.pre_gateway_net())})},y:function(a,b){var c=this,d=c.w;q({path:a.operator_url.CT,query:a.sign,fullurl:!0,get:!0,timeout:this.timeout,cb:b,recordurl:!0}).t(function(a){a&&0===a.result?c.z(a):(c.G(a),d.c("gateway_fail",e.pre_getmobile_result(a)))},function(){c.G({msg:"request failed"}),d.c("gateway_fail",e.pre_getmobile_net())})},z:function(a){var b=this.w;q({query:{custom:this.custom,phone:this.phone,process_id:this.process_id,accesscode:a.data},path:this.checkGatewayUrl,timeout:this.timeout,fullurl:!0}).t(function(a){a&&0===a.result?b.c("gateway_success"):b.c("gateway_fail",e.check_gateway_result(a))},function(){b.c("gateway_fail",e.check_gateway_net())})},A:function(a){var b=this;this.phone=a.phone;var c=this.w;q({protocol:this.protocol,domain:this.gtapi_domain,query:{phone:this.phone,process_id:this.process_id,custom:this.custom},path:"send_message",timeout:this.timeout}).t(function(a){a&&0===a.result?(b.message_id=a.message_id,c.c("sendmessage_success")):c.c("sendmessage_fail",e.send_message_result())},function(){c.c("sendmessage_fail",e.send_message_net())})},B:function(a){var b=this.w;q({query:{phone:this.phone,process_id:this.process_id,message_number:a,message_id:this.message_id,custom:this.custom},path:this.checkMessageUrl,fullurl:!0,timeout:this.timeout}).t(function(a){a&&0===a.result?b.c("checkmessage_success"):b.c("checkmessage_fail",e.check_message_result())},function(){b.c("checkmessage_fail",e.send_message_net())})},C:function(){this.process_id="",this.message_id=""},b:function(a,b){return this.w.b(a,b),this},G:function(a){q({protocol:this.protocol,domain:this.gtapi_domain,query:{process_id:this.process_id,data:a},path:"/client/h5",timeout:this.timeout})}},g.version="1.0.0",g.prototype={gateway:function(a){return this.F&&j.v(this.D).x(a),this},sendMessage:function(a){return this.F&&j.v(this.D).A(a),this},checkMessage:function(a){return this.F&&j.v(this.D).B(a),this},reset:function(){return this.F&&j.v(this.D).C(),this},onGatewaySuccess:function(a){return this.F&&j.v(this.D).b("gateway_success",a),this},onGatewayFail:function(a){return this.F&&j.v(this.D).b("gateway_fail",a),this},onSendMessageSuccess:function(a){return this.F&&j.v(this.D).b("sendmessage_success",a),this},onSendMessageFail:function(a){return this.F&&j.v(this.D).b("sendmessage_fail",a),this},onCheckMessageSuccess:function(a){return this.F&&j.v(this.D).b("checkmessage_success",a),this},onCheckMessageFail:function(a){return this.F&&j.v(this.D).b("checkmessage_fail",a),this},onError:function(a){return this.F&&j.v(this.D).b("error",a),this}},g});